!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bridge=t()}}(function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";e.exports=t("./lib/bridge")},{"./lib/bridge":5}],2:[function(t,e,n){"use strict";function r(t,e){this.bids=[],this.dealer=t,e&&(e=e.split(" ").filter(function(t){return 0!==t.trim().length}),this.bid(e))}var i=t("./bid"),o=t("./contract");r.prototype.bid=function(t){var e,n,r=this;arguments.length>1&&(t=Array.prototype.slice.call(arguments));{if(!Array.isArray(t)){if(("string"==typeof t||t instanceof String)&&(t=i[t]),this.isClosed())throw new Error("Bidding not allowed, auction is closed");if(t.isPass);else if(t.isDouble){if(e=this.nextSeatToBid(),void 0===(n=this.contract()).declaror)throw new Error("Cannot double when opposition has no contract");if(n.declaror===e.partner)throw new Error("Doubling your partner is not allowed");if(""!==n.risk)throw new Error("Opposition is already at risk")}else if(t.isRedouble){if(e=this.nextSeatToBid(),"X"!==(n=this.contract()).risk||e!==n.declaror&&e.partner!==n.declaror)throw new Error("Invalid bid")}else if(this.bids.some(function(e){return e.order>t.order}))throw new Error("Insufficient bid");return this.bids.push(t),t}t.forEach(function(t){r.bid(t)})}},r.prototype.isClosed=function(){return!(this.bids.length<4)&&this.bids.slice(-3).every(function(t){return t===i.pass})},r.prototype.nextSeatToBid=function(){return this.isClosed()?null:this.bids.reduce(function(t){return t.next},this.dealer)},r.prototype.contract=function(){var t=this.dealer,e=this.bids.reduce(function(e,n){return n.isPass||(n.isDouble?e.risk="X":n.isRedouble?e.risk="XX":(e.risk="",e.level=n.level,e.denomination=n.denomination,e.declaror=t)),t=t.next,e},new o);if(e.declaror){t=this.dealer;for(var n=0;n<this.bids.length;n++){if(this.bids[n].denomination===e.denomination&&(t===e.declaror||t===e.declaror.partner)){e.declaror=t;break}t=t.next}}return e},r.prototype.toString=function(){return this.bids.reduce(function(t,e){return t+e.toString()+" "},"").trim()},e.exports=r},{"./bid":3,"./contract":8}],3:[function(t,e,n){"use strict";function r(t){this.level=+t.charAt(0)||void 0,this.denomination=this.level?t.substr(1):void 0,this.order=5*(this.level-1)+i[this.denomination],this.isDouble="X"===t,this.isRedouble="XX"===t,this.isPass="-"===t||"P"===t||"/"===t||"Pass"===t,this.isRed="H"===this.denomination||"D"===this.denomination,this.isBlack="S"===this.denomination||"C"===this.denomination}var i={C:1,D:2,H:3,S:4,NT:5};r.prototype.toString=function(){return this.isPass?"-":this.isDouble?"X":this.isRedouble?"XX":this.level+this.denomination};var o={"-":new r("-"),X:new r("X"),XX:new r("XX"),"1C":new r("1C"),"1D":new r("1D"),"1H":new r("1H"),"1S":new r("1S"),"1NT":new r("1NT"),"2C":new r("2C"),"2D":new r("2D"),"2H":new r("2H"),"2S":new r("2S"),"2NT":new r("2NT"),"3C":new r("3C"),"3D":new r("3D"),"3H":new r("3H"),"3S":new r("3S"),"3NT":new r("3NT"),"4C":new r("4C"),"4D":new r("4D"),"4H":new r("4H"),"4S":new r("4S"),"4NT":new r("4NT"),"5C":new r("5C"),"5D":new r("5D"),"5H":new r("5H"),"5S":new r("5S"),"5NT":new r("5NT"),"6C":new r("6C"),"6D":new r("6D"),"6H":new r("6H"),"6S":new r("6S"),"6NT":new r("6NT"),"7C":new r("7C"),"7D":new r("7D"),"7H":new r("7H"),"7S":new r("7S"),"7NT":new r("7NT")};o.Pass=o.pass=o["-"],o.Double=o.double=o.X,o.Redouble=o.redouble=o.XX,e.exports=o},{}],4:[function(t,e,n){"use strict";function r(){this.vulnerability=void 0,this.dealer=void 0,this.hands={},this.hands[i.north]=new o,this.hands[i.east]=new o,this.hands[i.south]=new o,this.hands[i.west]=new o,this.number=1}var i=t("./seat"),o=t("./hand"),s=t("./pbn"),a=[i.north,i.east,i.south,i.west],u=["Nil","NS","EW","All","NS","EW","All","Nil","EW","All","Nil","NS","All","Nil","NS","EW"];r.prototype.isVulnerable=function(t){return"Nil"!==this.vulnerability&&("All"===this.vulnerability||-1!==this.vulnerability.indexOf(t.symbol))},r.prototype.setNumber=function(t){return this.number=t,this.dealer=a[(t-1)%4],this.vulnerability=u[(t-1)%16],this},r.prototype.deal=function(t){return 0===arguments.length?s.exportDeal(this.hands,this.dealer):(this.hands=s.importDeal(t),this)},e.exports=r},{"./hand":11,"./pbn":12,"./seat":13}],5:[function(t,e,n){"use strict";var r=e.exports={};r.card=t("./card"),r.bid=t("./bid"),r.seat=t("./seat"),r.Competition=t("./competition"),r.Session=t("./session"),r.Contract=t("./contract"),r.Trick=t("./trick"),r.Deck=t("./deck"),r.Hand=t("./hand"),r.Auction=t("./auction"),r.Board=t("./board"),r.Game=t("./game"),r.pbn=t("./pbn")},{"./auction":2,"./bid":3,"./board":4,"./card":6,"./competition":7,"./contract":8,"./deck":9,"./game":10,"./hand":11,"./pbn":12,"./seat":13,"./session":14,"./trick":15}],6:[function(t,e,n){"use strict";function r(t,e){this.rank=t,this.suit=e,this.order=i[this.rank]+o[this.suit]}var i={2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,T:9,J:10,Q:11,K:12,A:13},o={C:0,D:13,H:26,S:39};r.prototype.toString=function(){return this.rank+this.suit},r.imagePath="cards/",r.prototype.imageUrl=function(){return r.imagePath+this.rank+this.suit+".svg"};var s={all:[],imagePath:function(t){r.imagePath=t}};for(var a in i)for(var u in o){var l=new r(a,u);s.all.push(l),s[a+u]=l,s[u+a]=l,"T"===a&&(s["10"+u]=l,s[u+"10"]=l)}e.exports=s},{}],7:[function(t,e,n){"use strict";function r(){this.name=""}e.exports=r},{}],8:[function(t,e,n){"use strict";function r(){this.risk="",this.level=0,this.denomination=void 0,this.declaror=void 0}r.prototype.toString=function(){return this.isPassedIn()?"-":this.level+this.denomination+this.risk+" by "+this.declaror.symbol},r.prototype.isPassedIn=function(){return 0===this.level},r.prototype.dummy=function(){return this.declaror?this.declaror.partner:void 0},r.prototype.leader=function(){return this.declaror?this.declaror.lho:void 0},r.prototype.isOpponent=function(t){return t!==this.declaror&&t!==this.dummy()},e.exports=r},{}],9:[function(t,e,n){"use strict";function r(){this.cards=i.all.slice()}var i=t("./card"),o=t("./seat"),s=t("./hand"),a=t("crypto-shuffle");r.prototype.shuffle=function(){return a(this.cards),this},r.prototype.deal=function(t){var e=t,n={};n[o.north]=new s,n[o.south]=new s,n[o.east]=new s,n[o.west]=new s;for(var r=0;r<this.cards.length;++r)n[e=e.next].cards.push(this.cards[r]);return n[o.north].sort(),n[o.south].sort(),n[o.east].sort(),n[o.west].sort(),n},e.exports=r},{"./card":6,"./hand":11,"./seat":13,"crypto-shuffle":18}],10:[function(t,e,n){"use strict";function r(){this.auction=new o,this.contract=new s,this.tricks=[],this.players={},this.made=void 0}var i=t("./bridge"),o=t("./auction"),s=t("./contract");r.prototype.lead=function(){if(0!==this.tricks.length)return this.tricks[0].lead()},r.prototype.play=function(t){var e,n,r=this;if(0===arguments.length){var o=[];return this.tricks.forEach(function(t){t.play.forEach(function(t){o.push(t.card)})}),o}if(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),Array.isArray(t)){var s;return t.forEach(function(t){s=r.play(t)}),s}return"string"==typeof t&&(t=i.card[t]),0===this.tricks.length?(e=new i.Trick,this.tricks.push(e),n=this.contract.leader()):4===(e=this.tricks[this.tricks.length-1]).play.length?(n=e.winner(this.contract),e=new i.Trick,this.tricks.push(e)):n=e.play[e.play.length-1].seat.next,e.play.push({seat:n,card:t}),4===e.play.length?e.winner(this.contract):n.next},e.exports=r},{"./auction":2,"./bridge":5,"./contract":8}],11:[function(t,e,n){"use strict";function r(){this.cards=[],this.facts=[]}var i=t("./card");r.prototype.sort=function(){return this.cards.sort(function(t,e){return e.order-t.order}),this},r.prototype.cardsWithSuit=function(t){return this.cards.filter(function(e){return e.suit===t})},r.prototype.toString=function(){var t,e="";for(t=0;t<this.cards.length;++t)0!==t&&(e+=" "),e+=this.cards[t].toString();return e};var o={S:"H",H:"D",D:"C",C:null};r.prototype.toPBN=function(){if(0===this.cards.length)return"-";var t,e="",n="S";for(this.sort(),t=0;t<this.cards.length;++t){for(var r=this.cards[t];r.suit!==n;)e+=".",n=o[n];e+=r.rank}for(;null!==o[n];)e+=".",n=o[n];return e},r.parsePBN=function(t){var e=new r;if("-"===t)return e;if(4!==t.split(".").length)throw new Error("All four suits must be declared.");var n,s,a="S";for(s=0;s<t.length;++s)"."===(n=t[s])?a=o[a]:e.cards.push(i[n+a]);return e},r.prototype.hcp=function(){var t={A:4,K:3,Q:2,J:1};return this.cards.reduce(function(e,n){return e+(t[n.rank]||0)},0)},e.exports=r},{"./card":6}],12:[function(t,e,n){"use strict";function r(t){var e,n={},r=o[t[0]],i=t.slice(2).split(" ");for(e=0;e<4;++e)n[r]=s.parsePBN(i[e]),r=r.next;return n}function i(t,e){var n,r=(e=e||o.south).symbol+":";for(n=0;n<4;++n)0!==n&&(r+=" "),r+=t[e].toPBN(),e=e.next;return r}var o=t("./seat"),s=t("./hand");e.exports={importDeal:r,exportDeal:i}},{"./hand":11,"./seat":13}],13:[function(t,e,n){"use strict";function r(){this.symbol=""}r.prototype.toString=function(){return this.name};var i={north:new r,east:new r,south:new r,west:new r};i.north.symbol="N",i.north.name="north",i.north.partner=i.south,i.north.rho=i.west,i.north.lho=i.east,i.north.next=i.east,i.south.symbol="S",i.south.name="south",i.south.partner=i.north,i.south.rho=i.east,i.south.lho=i.west,i.south.next=i.west,i.east.symbol="E",i.east.name="east",i.east.partner=i.west,i.east.rho=i.north,i.east.lho=i.south,i.east.next=i.south,i.west.symbol="W",i.west.name="west",i.west.partner=i.east,i.west.rho=i.south,i.west.lho=i.north,i.west.next=i.north,i.N=i.north,i.S=i.south,i.E=i.east,i.W=i.west,i.distance=function(t,e){return t===e?0:t.lho===e?1:t.partner===e?2:3},e.exports=i},{}],14:[function(t,e,n){"use strict";function r(){this.competition=new i.Competition,this.site="",this.date="",this.boards=[],this.games=[]}var i=t("./bridge"),o=t("pbn"),s=t("stream").Readable;r.generateBoards=function(t){for(var e=new r,n=1;n<=t;++n){var o=new i.Board;o.setNumber(n),o.hands=(new i.Deck).shuffle().deal(o.dealer),e.boards.push(o)}return e},r.importPbn=function(t,e){function n(){return a||((a=new i.Game).board=u,a.auction.dealer=u.dealer,l.games.push(a)),a}if(!e)return new Promise(function(e,n){r.importPbn(t,function(t,r){t?n(t):e(r)})});var a,u,l=new r,c={None:"Nil",Love:"Nil","-":"Nil",All:"All",Both:"All",NS:"NS",EW:"EW"};if("string"==typeof t){var h=t;(t=new s).push(h),t.push(null)}t.pipe(o()).on("error",function(t){e(t)}).on("end",function(){e(null,l)}).on("data",function(t){if("game"===t.type)a=u=null;else if("tag"===t.type&&""!==t.value&&"?"!==t.value)if("Event"===t.name)l.competition.name=t.value;else if("Site"===t.name)l.site=t.value;else if("Date"===t.name)l.date=t.value;else if("Board"===t.name){var e=parseInt(t.value,10);(u=l.boards.find(function(t){return t.number===e}))||((u=new i.Board).setNumber(e),l.boards.push(u)),a&&(a.board=u)}else if("West"===t.name)n().players[i.seat.west]=t.value;else if("North"===t.name)n().players[i.seat.north]=t.value;else if("East"===t.name)n().players[i.seat.east]=t.value;else if("South"===t.name)n().players[i.seat.south]=t.value;else if("Dealer"===t.name)u.dealer=i.seat[t.value],a&&(a.auction.dealer=u.dealer);else if("Vulnerable"===t.name)u.vulnerability=c[t.value];else if("Deal"===t.name)u.deal(t.value);else if("Scoring"===t.name);else if("Declarer"===t.name)n().contract.declaror=i.seat[t.value];else if("Contract"===t.name)n(),a.contract.level=t.level,a.contract.denomination=t.denomination,a.contract.risk=t.risk;else if("Result"===t.name){var r=parseInt(t.value,10),o=n().contract,s=r>=o.level+6?r-6:r-(o.level+6);a.made=s}else if("Auction"===t.name){var h=n().auction;t.tokens.forEach(function(t){if("AP"===t)for(;!h.isClosed();)h.bid("Pass");else"-"===t||"*"===t||t.startsWith("=")||h.bid(t)})}else if("Play"===t.name){var d=n().tricks,f=new i.Trick;d.push(f);var p=i.seat[t.value],w=p;t.tokens.forEach(function(t){"-"===t||"*"===t?p=p.next:t.startsWith("=")||(4===f.play.length&&(w=f.winner(a.contract),f=new i.Trick,d.push(f)),f.play.push({seat:p,card:i.card[t]}),f.play.sort(function(t,e){return i.seat.distance(w,t.seat)-i.seat.distance(w,e.seat)}),p=p.next)})}})},e.exports=r},{"./bridge":5,pbn:17,stream:17}],15:[function(t,e,n){"use strict";function r(){this.play=[]}r.prototype.card=function(t){for(var e=0;e<this.play.length;++e)if(t===this.play[e].seat)return this.play[e].card},r.prototype.leader=function(){return this.play.length<1?void 0:this.play[0].seat},r.prototype.leaderSuit=function(){return this.play.length<1?void 0:this.play[0].card.suit},r.prototype.lead=function(){return this.play.length<1?void 0:this.play[0].card},r.prototype.winner=function(t){if(!(this.play.length<4)){for(var e,n,r,i=-1e4,o=this.leaderSuit(),s=0;s<4;++s){if(e=this.play[s],r=e.card.order,e.card.suit===t.denomination)r*=1e3;else if(e.card.suit!==o)continue;r>i&&(i=r,n=e.seat)}return n}},e.exports=r},{}],16:[function(t,e,n){},{}],17:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{dup:16}],18:[function(t,e,n){function r(t){var e,n,r=t.length,o=new Uint8Array(r);for(i(o);r>1;)e=o[r-1]%r,n=t[--r],t[r]=t[e],t[e]=n;return t}var i=t("get-random-values");e.exports=r},{"get-random-values":19}],19:[function(t,e,n){function r(t){if(i.crypto&&i.crypto.getRandomValues)return i.crypto.getRandomValues(t);if("object"==typeof i.msCrypto&&"function"==typeof i.msCrypto.getRandomValues)return i.msCrypto.getRandomValues(t);if(o.randomBytes){if(!(t instanceof Uint8Array))throw new TypeError("expected Uint8Array");if(t.length>65536){var e=new Error;throw e.code=22,e.message="Failed to execute 'getRandomValues' on 'Crypto': The ArrayBufferView's byte length ("+t.length+") exceeds the number of bytes of entropy available via this API (65536).",e.name="QuotaExceededError",e}var n=o.randomBytes(t.length);return t.set(n),t}throw new Error("No secure random number generator available.")}var i=t("global/window"),o=t("crypto");e.exports=r},{crypto:16,"global/window":20}],20:[function(t,e,n){(function(t){var n;n="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});